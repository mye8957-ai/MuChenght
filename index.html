<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ²è¾° å¡å¯†ç®¡ç†</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

  :root {
    --bg: #0a0a0f;
    --surface: #13131a;
    --surface2: #1c1c28;
    --border: #2a2a3d;
    --accent: #4f8ef7;
    --accent2: #7c3aed;
    --danger: #ef4444;
    --warning: #f59e0b;
    --success: #10b981;
    --text: #e8e8f0;
    --text2: #8888a8;
    --text3: #5555. 75;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans SC', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    background-image:
      radial-gradient(ellipse at 20% 20%, rgba(79,142,247,0.08) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 80%, rgba(124,58,237,0.08) 0%, transparent 50%);
  }

  .header {
    padding: 32px 40px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .header-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    box-shadow: 0 0 12px rgba(79,142,247,0.6);
  }

  .header h1 {
    font-size: 20px;
    font-weight: 700;
    letter-spacing: 0.05em;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .header-sub {
    margin-left: auto;
    font-size: 12px;
    color: var(--text2);
  }

  .container {
    max-width: 900px;
    margin: 0 auto;
    padding: 32px 24px;
  }

  /* ç»Ÿè®¡å¡ç‰‡ */
  .stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 28px;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
    text-align: center;
  }

  .stat-num {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .stat-label {
    font-size: 11px;
    color: var(--text2);
    letter-spacing: 0.05em;
  }

  .stat-card.total .stat-num { color: var(--accent); }
  .stat-card.active .stat-num { color: var(--success); }
  .stat-card.banned .stat-num { color: var(--danger); }
  .stat-card.expired .stat-num { color: var(--warning); }

  /* æ“ä½œåŒº */
  .actions {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
  }

  .actions-title {
    font-size: 13px;
    font-weight: 500;
    color: var(--text2);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 16px;
  }

  .form-row {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }

  input, select {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    color: var(--text);
    font-family: inherit;
    font-size: 13px;
    outline: none;
    transition: border-color 0.2s;
  }

  input:focus, select:focus {
    border-color: var(--accent);
  }

  input::placeholder { color: var(--text2); }

  .input-key { flex: 1; min-width: 180px; font-family: monospace; font-size: 13px; }
  .input-date { width: 160px; }

  select { width: 120px; }

  .btn {
    padding: 10px 18px;
    border-radius: 8px;
    border: none;
    font-family: inherit;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .btn:active { transform: scale(0.96); }

  .btn-primary {
    background: linear-gradient(135deg, var(--accent), #3a7bd5);
    color: white;
  }

  .btn-primary:hover { opacity: 0.88; }

  .btn-random {
    background: linear-gradient(135deg, var(--accent2), #5b21b6);
    color: white;
  }

  .btn-random:hover { opacity: 0.88; }

  .btn-ghost {
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
  }

  .btn-ghost:hover { border-color: var(--accent); color: var(--accent); }

  /* æœç´¢ */
  .search-row {
    display: flex;
    gap: 10px;
    margin-bottom: 16px;
    align-items: center;
  }

  .search-input {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 16px;
    color: var(--text);
    font-family: inherit;
    font-size: 13px;
    outline: none;
  }

  .search-input:focus { border-color: var(--accent); }
  .search-input::placeholder { color: var(--text2); }

  /* å¡å¯†åˆ—è¡¨ */
  .list-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }

  .list-title {
    font-size: 13px;
    font-weight: 500;
    color: var(--text2);
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  .list-count {
    font-size: 12px;
    color: var(--text2);
  }

  .key-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .key-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: border-color 0.2s;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .key-item:hover { border-color: var(--border); }
  .key-item.banned { border-left: 3px solid var(--danger); opacity: 0.7; }
  .key-item.expired { border-left: 3px solid var(--warning); opacity: 0.7; }
  .key-item.active { border-left: 3px solid var(--success); }

  .key-text {
    font-family: monospace;
    font-size: 14px;
    color: var(--text);
    flex: 1;
    letter-spacing: 0.05em;
  }

  .key-expire {
    font-size: 11px;
    color: var(--text2);
    white-space: nowrap;
  }

  .key-status {
    padding: 3px 8px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 500;
    white-space: nowrap;
  }

  .status-active { background: rgba(16,185,129,0.15); color: var(--success); }
  .status-banned { background: rgba(239,68,68,0.15); color: var(--danger); }
  .status-expired { background: rgba(245,158,11,0.15); color: var(--warning); }

  .key-actions { display: flex; gap: 6px; }

  .btn-sm {
    padding: 5px 10px;
    border-radius: 6px;
    border: none;
    font-family: inherit;
    font-size: 11px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s;
  }

  .btn-sm:active { transform: scale(0.94); }

  .btn-ban { background: rgba(239,68,68,0.15); color: var(--danger); }
  .btn-ban:hover { background: rgba(239,68,68,0.25); }
  .btn-unban { background: rgba(16,185,129,0.15); color: var(--success); }
  .btn-unban:hover { background: rgba(16,185,129,0.25); }
  .btn-del { background: rgba(239,68,68,0.1); color: #f87171; }
  .btn-del:hover { background: rgba(239,68,68,0.22); }

  .empty {
    text-align: center;
    padding: 48px;
    color: var(--text2);
    font-size: 14px;
  }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 28px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px 20px;
    font-size: 13px;
    color: var(--text);
    opacity: 0;
    transition: all 0.3s;
    z-index: 999;
    white-space: nowrap;
  }

  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  .toast.success { border-color: var(--success); color: var(--success); }
  .toast.error { border-color: var(--danger); color: var(--danger); }

  /* Loading */
  .loading {
    display: inline-block;
    width: 14px; height: 14px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    vertical-align: middle;
    margin-right: 6px;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  @media (max-width: 600px) {
    .stats { grid-template-columns: repeat(2, 1fr); }
    .header { padding: 20px; }
    .container { padding: 20px 16px; }
    .form-row { flex-direction: column; align-items: stretch; }
    .input-date, select, .btn { width: 100%; }
  }
</style>
</head>
<body>

<div class="header">
  <div class="header-dot"></div>
  <h1>æ²è¾° Â· å¡å¯†ç®¡ç†</h1>
  <span class="header-sub" id="sync-status">æ­£åœ¨åŠ è½½...</span>
</div>

<div class="container">

  <!-- ç»Ÿè®¡ -->
  <div class="stats">
    <div class="stat-card total"><div class="stat-num" id="s-total">0</div><div class="stat-label">æ€»å¡å¯†</div></div>
    <div class="stat-card active"><div class="stat-num" id="s-active">0</div><div class="stat-label">æœ‰æ•ˆ</div></div>
    <div class="stat-card banned"><div class="stat-num" id="s-banned">0</div><div class="stat-label">å°ç¦</div></div>
    <div class="stat-card expired"><div class="stat-num" id="s-expired">0</div><div class="stat-label">è¿‡æœŸ</div></div>
  </div>

  <!-- æ·»åŠ å¡å¯† -->
  <div class="actions">
    <div class="actions-title">æ·»åŠ å¡å¯†</div>
    <div class="form-row">
      <input class="input-key" id="new-key" placeholder="è¾“å…¥å¡å¯†å†…å®¹..." />
      <input class="input-date" id="new-expire" type="date" />
      <button class="btn btn-random" onclick="genRandom()">ğŸ² éšæœºç”Ÿæˆ</button>
      <button class="btn btn-primary" onclick="addKey()">+ æ·»åŠ </button>
    </div>
  </div>

  <!-- æœç´¢+åˆ—è¡¨ -->
  <div class="search-row">
    <input class="search-input" id="search" placeholder="æœç´¢å¡å¯†..." oninput="renderList()" />
    <button class="btn btn-ghost" onclick="loadKeys()">â†» åˆ·æ–°</button>
  </div>

  <div class="list-header">
    <span class="list-title">å¡å¯†åˆ—è¡¨</span>
    <span class="list-count" id="list-count"></span>
  </div>

  <div class="key-list" id="key-list">
    <div class="empty">æ­£åœ¨åŠ è½½...</div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
// ===== é…ç½® =====
const GITHUB_TOKEN = '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';
const OWNER = 'mye8957-ai';
const REPO = 'MuChengjs';
const FILE_PATH = 'keys.json';
const API = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`;

let keys = [];
let fileSha = '';

// ===== GitHub API =====
async function loadKeys() {
  setStatus('åŒæ­¥ä¸­...');
  try {
    const res = await fetch(API, {
      headers: {
        'Authorization': `token ${GITHUB_TOKEN}`,
        'Accept': 'application/vnd.github.v3+json'
      }
    });
    if (!res.ok) throw new Error('è¯·æ±‚å¤±è´¥ ' + res.status);
    const data = await res.json();
    fileSha = data.sha;
    const content = atob(data.content.replace(/\n/g, ''));
    const json = JSON.parse(content);
    keys = json.keys || [];
    renderList();
    updateStats();
    setStatus('ä¸Šæ¬¡åŒæ­¥ ' + new Date().toLocaleTimeString());
  } catch(e) {
    setStatus('åŠ è½½å¤±è´¥');
    toast('åŠ è½½å¤±è´¥: ' + e.message, 'error');
  }
}

async function saveKeys() {
  const content = btoa(unescape(encodeURIComponent(JSON.stringify({ keys }, null, 2))));
  try {
    const res = await fetch(API, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${GITHUB_TOKEN}`,
        'Accept': 'application/vnd.github.v3+json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: 'æ›´æ–°å¡å¯†',
        content,
        sha: fileSha
      })
    });
    if (!res.ok) throw new Error('ä¿å­˜å¤±è´¥ ' + res.status);
    const data = await res.json();
    fileSha = data.content.sha;
    toast('ä¿å­˜æˆåŠŸ', 'success');
    setStatus('ä¸Šæ¬¡åŒæ­¥ ' + new Date().toLocaleTimeString());
  } catch(e) {
    toast('ä¿å­˜å¤±è´¥: ' + e.message, 'error');
  }
}

// ===== æ“ä½œ =====
function genRandom() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
  let result = 'MC-';
  for (let i = 0; i < 12; i++) {
    if (i === 4 || i === 8) result += '-';
    result += chars[Math.floor(Math.random() * chars.length)];
  }
  document.getElementById('new-key').value = result;
}

function addKey() {
  const key = document.getElementById('new-key').value.trim();
  const expire = document.getElementById('new-expire').value;
  if (!key) return toast('è¯·è¾“å…¥å¡å¯†å†…å®¹', 'error');
  if (!expire) return toast('è¯·é€‰æ‹©åˆ°æœŸæ—¶é—´', 'error');
  if (keys.find(k => k.key === key)) return toast('å¡å¯†å·²å­˜åœ¨', 'error');
  keys.push({ key, expire, banned: false, created: new Date().toISOString().split('T')[0] });
  document.getElementById('new-key').value = '';
  renderList();
  updateStats();
  saveKeys();
}

function banKey(key) {
  const k = keys.find(k => k.key === key);
  if (k) { k.banned = true; renderList(); updateStats(); saveKeys(); }
}

function unbanKey(key) {
  const k = keys.find(k => k.key === key);
  if (k) { k.banned = false; renderList(); updateStats(); saveKeys(); }
}

function deleteKey(key) {
  if (!confirm('ç¡®è®¤åˆ é™¤å¡å¯† ' + key + 'ï¼Ÿ')) return;
  keys = keys.filter(k => k.key !== key);
  renderList();
  updateStats();
  saveKeys();
}

// ===== æ¸²æŸ“ =====
function isExpired(expire) {
  return new Date(expire) < new Date();
}

function getStatus(k) {
  if (k.banned) return 'banned';
  if (isExpired(k.expire)) return 'expired';
  return 'active';
}

function renderList() {
  const search = document.getElementById('search').value.toLowerCase();
  const filtered = keys.filter(k => k.key.toLowerCase().includes(search));
  const list = document.getElementById('key-list');
  document.getElementById('list-count').textContent = filtered.length + ' æ¡';

  if (filtered.length === 0) {
    list.innerHTML = '<div class="empty">æš‚æ— å¡å¯†</div>';
    return;
  }

  list.innerHTML = filtered.map(k => {
    const st = getStatus(k);
    const stLabel = { active: 'æœ‰æ•ˆ', banned: 'å°ç¦', expired: 'è¿‡æœŸ' }[st];
    const stClass = { active: 'status-active', banned: 'status-banned', expired: 'status-expired' }[st];
    const banBtn = k.banned
      ? `<button class="btn-sm btn-unban" onclick="unbanKey('${k.key}')">è§£ç¦</button>`
      : `<button class="btn-sm btn-ban" onclick="banKey('${k.key}')">å°ç¦</button>`;
    return `
      <div class="key-item ${st}">
        <span class="key-text">${k.key}</span>
        <span class="key-expire">åˆ°æœŸ ${k.expire}</span>
        <span class="key-status ${stClass}">${stLabel}</span>
        <div class="key-actions">
          ${banBtn}
          <button class="btn-sm btn-del" onclick="deleteKey('${k.key}')">åˆ é™¤</button>
        </div>
      </div>`;
  }).join('');
}

function updateStats() {
  const total = keys.length;
  const banned = keys.filter(k => k.banned).length;
  const expired = keys.filter(k => !k.banned && isExpired(k.expire)).length;
  const active = total - banned - expired;
  document.getElementById('s-total').textContent = total;
  document.getElementById('s-active').textContent = active;
  document.getElementById('s-banned').textContent = banned;
  document.getElementById('s-expired').textContent = expired;
}

// ===== å·¥å…· =====
function setStatus(msg) {
  document.getElementById('sync-status').textContent = msg;
}

let toastTimer;
function toast(msg, type = '') {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className = 'toast show ' + type;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.className = 'toast', 2800);
}

// é»˜è®¤åˆ°æœŸæ—¶é—´ä¸ºä»Šå¤©+30å¤©
const d = new Date();
d.setDate(d.getDate() + 30);
document.getElementById('new-expire').value = d.toISOString().split('T')[0];

loadKeys();
</script>
</body>
</html>

