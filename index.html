<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ²è¾° å¡å¯†ç®¡ç†</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

  :root {
    --bg: #0a0a0f;
    --surface: #13131a;
    --surface2: #1c1c28;
    --border: #2a2a3d;
    --accent: #4f8ef7;
    --accent2: #7c3aed;
    --danger: #ef4444;
    --warning: #f59e0b;
    --success: #10b981;
    --text: #e8e8f0;
    --text2: #8888a8;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans SC', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    background-image:
      radial-gradient(ellipse at 20% 20%, rgba(79,142,247,0.08) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 80%, rgba(124,58,237,0.08) 0%, transparent 50%);
  }

  .header {
    padding: 28px 40px 20px;
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; gap: 14px;
  }

  .header-dot {
    width: 10px; height: 10px; border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    box-shadow: 0 0 12px rgba(79,142,247,0.6);
  }

  .header h1 {
    font-size: 18px; font-weight: 700;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }

  .header-sub { margin-left: auto; font-size: 12px; color: var(--text2); }

  .container { max-width: 1000px; margin: 0 auto; padding: 28px 20px; }

  .stats {
    display: grid; grid-template-columns: repeat(4, 1fr);
    gap: 10px; margin-bottom: 24px;
  }

  .stat-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 14px; text-align: center;
  }

  .stat-num { font-size: 26px; font-weight: 700; margin-bottom: 3px; }
  .stat-label { font-size: 11px; color: var(--text2); }
  .stat-card.total .stat-num { color: var(--accent); }
  .stat-card.active .stat-num { color: var(--success); }
  .stat-card.banned .stat-num { color: var(--danger); }
  .stat-card.expired .stat-num { color: var(--warning); }

  .actions {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; padding: 20px; margin-bottom: 20px;
  }

  .actions-title {
    font-size: 11px; font-weight: 500; color: var(--text2);
    letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 14px;
  }

  .form-row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

  input, select {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 8px; padding: 9px 12px; color: var(--text);
    font-family: inherit; font-size: 13px; outline: none; transition: border-color 0.2s;
  }

  input:focus, select:focus { border-color: var(--accent); }
  input::placeholder { color: var(--text2); }
  .input-key { flex: 1; min-width: 160px; font-family: monospace; }
  select { cursor: pointer; }

  .btn {
    padding: 9px 16px; border-radius: 8px; border: none;
    font-family: inherit; font-size: 13px; font-weight: 500;
    cursor: pointer; transition: all 0.2s; white-space: nowrap;
  }

  .btn:active { transform: scale(0.96); }
  .btn-primary { background: linear-gradient(135deg, var(--accent), #3a7bd5); color: white; }
  .btn-primary:hover { opacity: 0.88; }
  .btn-random { background: linear-gradient(135deg, var(--accent2), #5b21b6); color: white; }
  .btn-random:hover { opacity: 0.88; }
  .btn-ghost { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
  .btn-ghost:hover { border-color: var(--accent); color: var(--accent); }

  .search-row { display: flex; gap: 8px; margin-bottom: 14px; }
  .search-input {
    flex: 1; background: var(--surface); border: 1px solid var(--border);
    border-radius: 10px; padding: 9px 14px; color: var(--text);
    font-family: inherit; font-size: 13px; outline: none;
  }
  .search-input:focus { border-color: var(--accent); }
  .search-input::placeholder { color: var(--text2); }

  .list-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
  .list-title { font-size: 11px; font-weight: 500; color: var(--text2); letter-spacing: 0.08em; text-transform: uppercase; }
  .list-count { font-size: 12px; color: var(--text2); }

  .table-head {
    display: grid;
    grid-template-columns: 2fr 0.8fr 0.6fr 0.5fr 1.2fr 1.8fr;
    gap: 8px; padding: 8px 14px;
    font-size: 11px; color: var(--text2);
    letter-spacing: 0.05em; text-transform: uppercase;
    border-bottom: 1px solid var(--border); margin-bottom: 6px;
  }

  .key-list { display: flex; flex-direction: column; gap: 6px; }

  .key-item {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 10px; padding: 12px 14px;
    display: grid;
    grid-template-columns: 2fr 0.8fr 0.6fr 0.5fr 1.2fr 1.8fr;
    gap: 8px; align-items: center;
    animation: fadeIn 0.25s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .key-item.banned { border-left: 3px solid var(--danger); opacity: 0.7; }
  .key-item.expired { border-left: 3px solid var(--warning); opacity: 0.7; }
  .key-item.active { border-left: 3px solid var(--success); }

  .key-text {
    font-family: monospace; font-size: 13px; color: var(--text);
    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
  }

  .key-expire { font-size: 12px; color: var(--text2); }

  .key-status {
    padding: 2px 7px; border-radius: 20px;
    font-size: 11px; font-weight: 500; white-space: nowrap; width: fit-content;
  }

  .status-active { background: rgba(16,185,129,0.15); color: var(--success); }
  .status-banned { background: rgba(239,68,68,0.15); color: var(--danger); }
  .status-expired { background: rgba(245,158,11,0.15); color: var(--warning); }

  .blue-col { display: flex; align-items: center; justify-content: center; }
  .blue-badge {
    display: inline-flex; align-items: center; justify-content: center;
    width: 20px; height: 20px; border-radius: 50%;
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    font-size: 11px; color: white;
  }
  .no-badge { color: var(--text2); font-size: 12px; }

  .time-col { display: flex; align-items: center; gap: 3px; }
  .btn-time {
    width: 24px; height: 24px; border-radius: 6px; border: 1px solid var(--border);
    background: var(--surface2); color: var(--text); font-size: 12px;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: all 0.15s; font-family: inherit;
  }
  .btn-time:hover { border-color: var(--accent); color: var(--accent); }
  .btn-time:active { transform: scale(0.9); }

  .key-actions { display: flex; gap: 4px; flex-wrap: wrap; }

  .btn-sm {
    padding: 4px 8px; border-radius: 6px; border: none;
    font-family: inherit; font-size: 11px; font-weight: 500;
    cursor: pointer; transition: all 0.15s; white-space: nowrap;
  }
  .btn-sm:active { transform: scale(0.94); }
  .btn-ban { background: rgba(239,68,68,0.15); color: var(--danger); }
  .btn-ban:hover { background: rgba(239,68,68,0.25); }
  .btn-unban { background: rgba(16,185,129,0.15); color: var(--success); }
  .btn-unban:hover { background: rgba(16,185,129,0.25); }
  .btn-del { background: rgba(239,68,68,0.1); color: #f87171; }
  .btn-del:hover { background: rgba(239,68,68,0.22); }
  .btn-blue { background: rgba(59,130,246,0.15); color: #60a5fa; }
  .btn-blue:hover { background: rgba(59,130,246,0.25); }
  .btn-unblue { background: rgba(107,114,128,0.15); color: #9ca3af; }
  .btn-unblue:hover { background: rgba(107,114,128,0.25); }

  .empty { text-align: center; padding: 40px; color: var(--text2); font-size: 13px; }

  .toast {
    position: fixed; bottom: 24px; left: 50%;
    transform: translateX(-50%) translateY(16px);
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 10px; padding: 10px 18px;
    font-size: 13px; color: var(--text);
    opacity: 0; transition: all 0.3s; z-index: 999; white-space: nowrap;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
  .toast.success { border-color: var(--success); color: var(--success); }
  .toast.error { border-color: var(--danger); color: var(--danger); }

  @media (max-width: 700px) {
    .stats { grid-template-columns: repeat(2, 1fr); }
    .header { padding: 16px; }
    .container { padding: 16px 12px; }
    .table-head { display: none; }
    .key-item { grid-template-columns: 1fr; }
    .form-row { flex-direction: column; align-items: stretch; }
  }
</style>
</head>
<body>

<div class="header">
  <div class="header-dot"></div>
  <h1>æ²è¾° Â· å¡å¯†ç®¡ç†</h1>
  <span class="header-sub" id="sync-status">æ­£åœ¨åŠ è½½...</span>
</div>

<div class="container">

  <div class="stats">
    <div class="stat-card total"><div class="stat-num" id="s-total">0</div><div class="stat-label">æ€»å¡å¯†</div></div>
    <div class="stat-card active"><div class="stat-num" id="s-active">0</div><div class="stat-label">æœ‰æ•ˆ</div></div>
    <div class="stat-card banned"><div class="stat-num" id="s-banned">0</div><div class="stat-label">å°ç¦</div></div>
    <div class="stat-card expired"><div class="stat-num" id="s-expired">0</div><div class="stat-label">è¿‡æœŸ</div></div>
  </div>

  <div class="actions">
    <div class="actions-title">æ·»åŠ å¡å¯†</div>
    <div class="form-row">
      <input class="input-key" id="new-key" placeholder="è¾“å…¥å¡å¯†å†…å®¹..." />
      <select id="new-type">
        <option value="day">å¤©å¡ (1å¤©)</option>
        <option value="week">å‘¨å¡ (7å¤©)</option>
        <option value="month" selected>æœˆå¡ (30å¤©)</option>
        <option value="forever">æ°¸ä¹…å¡</option>
      </select>
      <button class="btn btn-random" onclick="genRandom()">ğŸ² éšæœºç”Ÿæˆ</button>
      <button class="btn btn-primary" onclick="addKey()">+ æ·»åŠ </button>
    </div>
  </div>

  <div class="search-row">
    <input class="search-input" id="search" placeholder="æœç´¢å¡å¯†..." oninput="renderList()" />
    <button class="btn btn-ghost" onclick="loadKeys()">â†» åˆ·æ–°</button>
  </div>

  <div class="list-header">
    <span class="list-title">å¡å¯†åˆ—è¡¨</span>
    <span class="list-count" id="list-count"></span>
  </div>

  <div class="table-head">
    <span>å¡å¯†</span>
    <span>åˆ°æœŸæ—¶é—´</span>
    <span>çŠ¶æ€</span>
    <span style="text-align:center">è“æ ‡</span>
    <span>è°ƒæ•´æ—¶é—´</span>
    <span>æ“ä½œ</span>
  </div>

  <div class="key-list" id="key-list">
    <div class="empty">æ­£åœ¨åŠ è½½...</div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
const GITHUB_TOKEN = 'ä½ çš„æ–°token';
const OWNER = 'mye8957-ai';
const REPO = 'MuChengjs';
const FILE_PATH = 'keys.json';
const API = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`;

let keys = [];
let fileSha = '';

async function loadKeys() {
  setStatus('åŒæ­¥ä¸­...');
  try {
    const res = await fetch(API, {
      headers: {
        'Authorization': `token ${GITHUB_TOKEN}`,
        'Accept': 'application/vnd.github.v3+json'
      }
    });
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    fileSha = data.sha;
    const content = atob(data.content.replace(/\n/g, ''));
    const json = JSON.parse(content);
    keys = json.keys || [];
    renderList();
    updateStats();
    setStatus('ä¸Šæ¬¡åŒæ­¥ ' + new Date().toLocaleTimeString());
  } catch(e) {
    setStatus('åŠ è½½å¤±è´¥');
    toast('åŠ è½½å¤±è´¥: ' + e.message, 'error');
  }
}

async function saveKeys() {
  const content = btoa(unescape(encodeURIComponent(JSON.stringify({ keys }, null, 2))));
  try {
    const res = await fetch(API, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${GITHUB_TOKEN}`,
        'Accept': 'application/vnd.github.v3+json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ message: 'æ›´æ–°å¡å¯†', content, sha: fileSha })
    });
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    fileSha = data.content.sha;
    toast('ä¿å­˜æˆåŠŸ', 'success');
    setStatus('ä¸Šæ¬¡åŒæ­¥ ' + new Date().toLocaleTimeString());
  } catch(e) {
    toast('ä¿å­˜å¤±è´¥: ' + e.message, 'error');
  }
}

function getExpireByType(type) {
  const d = new Date();
  if (type === 'day') d.setDate(d.getDate() + 1);
  else if (type === 'week') d.setDate(d.getDate() + 7);
  else if (type === 'month') d.setDate(d.getDate() + 30);
  else if (type === 'forever') return '9999-12-31';
  return d.toISOString().split('T')[0];
}

function isExpired(expire) {
  if (expire === '9999-12-31') return false;
  return new Date(expire) < new Date();
}

function getStatus(k) {
  if (k.banned) return 'banned';
  if (isExpired(k.expire)) return 'expired';
  return 'active';
}

function addDays(expire, days) {
  const base = (expire === '9999-12-31') ? new Date() : new Date(expire);
  base.setDate(base.getDate() + days);
  return base.toISOString().split('T')[0];
}

function genRandom() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
  let result = 'MC-';
  for (let i = 0; i < 12; i++) {
    if (i === 4 || i === 8) result += '-';
    result += chars[Math.floor(Math.random() * chars.length)];
  }
  document.getElementById('new-key').value = result;
}

function addKey() {
  const key = document.getElementById('new-key').value.trim();
  const type = document.getElementById('new-type').value;
  if (!key) return toast('è¯·è¾“å…¥å¡å¯†å†…å®¹', 'error');
  if (keys.find(k => k.key === key)) return toast('å¡å¯†å·²å­˜åœ¨', 'error');
  keys.push({
    key, expire: getExpireByType(type),
    banned: false, blue: false,
    created: new Date().toISOString().split('T')[0]
  });
  document.getElementById('new-key').value = '';
  renderList(); updateStats(); saveKeys();
}

function banKey(key) {
  const k = keys.find(k => k.key === key);
  if (k) { k.banned = true; renderList(); updateStats(); saveKeys(); }
}

function unbanKey(key) {
  const k = keys.find(k => k.key === key);
  if (k) { k.banned = false; renderList(); updateStats(); saveKeys(); }
}

function deleteKey(key) {
  if (!confirm('ç¡®è®¤åˆ é™¤å¡å¯† ' + key + 'ï¼Ÿ')) return;
  keys = keys.filter(k => k.key !== key);
  renderList(); updateStats(); saveKeys();
}

function giveBlue(key) {
  const k = keys.find(k => k.key === key);
  if (k) { k.blue = true; renderList(); saveKeys(); toast('å·²ç»™äºˆè“æ ‡', 'success'); }
}

function removeBlue(key) {
  const k = keys.find(k => k.key === key);
  if (k) { k.blue = false; renderList(); saveKeys(); toast('å·²æ’¤é”€è“æ ‡', 'success'); }
}

function adjustTime(key, days) {
  const k = keys.find(k => k.key === key);
  if (!k) return;
  if (k.expire === '9999-12-31' && days > 0) {
    toast('æ°¸ä¹…å¡æ— éœ€åŠ æ—¶', 'error'); return;
  }
  const newExpire = addDays(k.expire, days);
  const today = new Date().toISOString().split('T')[0];
  if (newExpire < today) {
    toast('æ—¶é—´ä¸èƒ½æ—©äºä»Šå¤©', 'error'); return;
  }
  k.expire = newExpire;
  renderList(); updateStats(); saveKeys();
  toast((days > 0 ? '+' : '') + days + 'å¤©', 'success');
}

function renderList() {
  const search = document.getElementById('search').value.toLowerCase();
  const filtered = keys.filter(k => k.key.toLowerCase().includes(search));
  const list = document.getElementById('key-list');
  document.getElementById('list-count').textContent = filtered.length + ' æ¡';

  if (filtered.length === 0) {
    list.innerHTML = '<div class="empty">æš‚æ— å¡å¯†</div>';
    return;
  }

  list.innerHTML = filtered.map(k => {
    const st = getStatus(k);
    const stLabel = { active: 'æœ‰æ•ˆ', banned: 'å°ç¦', expired: 'è¿‡æœŸ' }[st];
    const stClass = { active: 'status-active', banned: 'status-banned', expired: 'status-expired' }[st];
    const expireLabel = k.expire === '9999-12-31' ? 'æ°¸ä¹…' : k.expire;
    const banBtn = k.banned
      ? `<button class="btn-sm btn-unban" onclick="unbanKey('${k.key}')">è§£ç¦</button>`
      : `<button class="btn-sm btn-ban" onclick="banKey('${k.key}')">å°ç¦</button>`;
    const blueBtn = k.blue
      ? `<button class="btn-sm btn-unblue" onclick="removeBlue('${k.key}')">æ’¤é”€è“æ ‡</button>`
      : `<button class="btn-sm btn-blue" onclick="giveBlue('${k.key}')">ç»™äºˆè“æ ‡</button>`;
    const blueIcon = k.blue
      ? `<span class="blue-badge">âœ“</span>`
      : `<span class="no-badge">â€”</span>`;

    return `
      <div class="key-item ${st}">
        <span class="key-text" title="${k.key}">${k.key}</span>
        <span class="key-expire">${expireLabel}</span>
        <span class="key-status ${stClass}">${stLabel}</span>
        <div class="blue-col">${blueIcon}</div>
        <div class="time-col">
          <button class="btn-time" onclick="adjustTime('${k.key}',-7)" title="å‡7å¤©">âˆ’7</button>
          <button class="btn-time" onclick="adjustTime('${k.key}',-1)" title="å‡1å¤©">âˆ’1</button>
          <button class="btn-time" onclick="adjustTime('${k.key}',1)" title="åŠ 1å¤©">+1</button>
          <button class="btn-time" onclick="adjustTime('${k.key}',7)" title="åŠ 7å¤©">+7</button>
        </div>
        <div class="key-actions">
          ${banBtn}
          ${blueBtn}
          <button class="btn-sm btn-del" onclick="deleteKey('${k.key}')">åˆ é™¤</button>
        </div>
      </div>`;
  }).join('');
}

function updateStats() {
  const total = keys.length;
  const banned = keys.filter(k => k.banned).length;
  const expired = keys.filter(k => !k.banned && isExpired(k.expire)).length;
  const active = total - banned - expired;
  document.getElementById('s-total').textContent = total;
  document.getElementById('s-active').textContent = active;
  document.getElementById('s-banned').textContent = banned;
  document.getElementById('s-expired').textContent = expired;
}

function setStatus(msg) { document.getElementById('sync-status').textContent = msg; }

let toastTimer;
function toast(msg, type = '') {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className = 'toast show ' + type;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.className = 'toast', 2800);
}

loadKeys();
</script>
</body>
</html>
